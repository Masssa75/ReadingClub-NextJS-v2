module.exports=[22640,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(62641);function e({phoneme:a,isCalibrated:c,isRecording:d,onClick:e}){let f=`
    bg-white/10 rounded-2xl p-5 text-center cursor-pointer
    border-3 transition-all duration-300
    hover:bg-white/15
    ${d?"border-red-500 bg-red-500/20 animate-pulse":"border-transparent"}
    ${c?"border-green-600 bg-green-600/20":""}
  `;return(0,b.jsxs)("div",{className:f,onClick:e,children:[(0,b.jsx)("div",{className:`text-5xl font-bold mb-2 ${c?"bg-gradient-to-br from-yellow-400 to-orange-500 bg-clip-text text-transparent font-bold":""}`,children:a.letter}),(0,b.jsx)("div",{className:"text-sm text-gray-400 mb-1",children:a.hint}),(0,b.jsx)("div",{className:"text-xs mt-2",children:c?"âœ“ Calibrated":"Click to record"})]})}var f=a.i(31626),g=a.i(78625),h=a.i(8410),i=a.i(78530),j=a.i(63851);function k({letter:a,onClose:e,onSuccess:k}){let{currentProfileId:l}=(0,j.useProfileContext)(),[m,n]=(0,c.useState)("Click letter to hear sound, then click box 1"),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(["ready","empty","empty","empty","empty"]),u=(0,c.useRef)(null),v=(0,c.useRef)([]),w=(0,c.useRef)(!1),x=(0,c.useRef)(-1),y=(0,c.useRef)(null),z=(0,c.useRef)([]),A=(0,c.useRef)(0);(0,c.useEffect)(()=>(C(),()=>{B()}),[]);let B=(0,c.useCallback)(()=>{y.current&&cancelAnimationFrame(y.current),u.current&&(0,g.stopAudio)(u.current)},[]),C=async()=>{try{u.current=await (0,g.setupAudio)(),D()}catch(a){console.error("Failed to setup audio:",a),n("âŒ Microphone access denied")}},D=()=>{let b=()=>{if(y.current=requestAnimationFrame(b),u.current?.analyser&&u.current?.dataArray&&((0,h.getFrequencyData)(u.current.analyser,u.current.dataArray),w.current&&x.current>=0)){let b=(0,h.calculateVolume)(u.current.dataArray),c=(0,h.downsampleTo64Bins)(u.current.dataArray),d=(0,h.calculateEnergyConcentration)(c),e=(0,h.isNasal)(a)?3:12,f=(0,h.isNasal)(a)?1.2:2,g=Date.now();if(b>e&&d>f&&g-A.current>500){let b=(0,h.normalizePattern)(c,a);v.current.push(b),A.current=g;let d=x.current;console.log(`ðŸ“¸ Captured snapshot ${v.current.length}/5`),E(d,b);let e=[...s];e[d]="captured",d+1<5&&(e[d+1]="ready"),t(e),w.current=!1,x.current=-1;let f=v.current.length;f<5?n(`âœ“ Captured ${f}/5. Click box ${f+1}`):(n("âœ“ All 5 captured! Saving..."),setTimeout(()=>{G()},500))}}};b()},E=(a,b)=>{let c=z.current[a];if(!c)return;let d=c.getContext("2d");if(!d)return;d.clearRect(0,0,c.width,c.height);let e=c.width/b.length;for(let a=0;a<b.length;a++){let f=b[a]*c.height,g=a*e,h=c.height-f;d.fillStyle="#7CB342",d.fillRect(g,h,e-1,f)}},F=()=>{let b=d.PHONEMES.find(b=>b.letter===a.toLowerCase());b&&b.audioUrl?new Audio(b.audioUrl).play().catch(a=>{console.error("Audio playback failed:",a)}):console.log(`No audio file for letter: ${a}`)},G=async()=>{if(B(),v.current.length<3)return void n("Not enough snapshots. Please retry.");let b=H(v.current),c=J(b.cluster);l?await K(a,c,l)&&(console.log(`Calibrated ${a}: Used ${b.cluster.length}/${v.current.length} snapshots`),n("âœ… Calibration complete! Click Next to continue."),r(!0),k(a)):n("âŒ No profile selected")},H=a=>{if(a.length<=3)return{cluster:a,indices:a.map((a,b)=>b)};let b=[];for(let c=0;c<a.length;c++)for(let d=c+1;d<a.length;d++){let e=I(a[c],a[d]);b.push({i:c,j:d,dist:e})}b.sort((a,b)=>a.dist-b.dist);let c=b[0],d=[c.i,c.j],e=null,f=1/0;for(let b=0;b<a.length;b++){if(d.includes(b))continue;let c=(I(a[b],a[d[0]])+I(a[b],a[d[1]]))/2;c<f&&(f=c,e=b)}return null!==e&&d.push(e),{cluster:d.map(b=>a[b]),indices:d}},I=(a,b)=>{let c=0;for(let d=0;d<a.length;d++)c+=Math.abs(a[d]-b[d]);return c},J=a=>{let b=a[0].length,c=Array(b).fill(0);for(let d of a)for(let a=0;a<b;a++)c[a]+=d[a];return c.map(b=>b/a.length)},K=async(a,b,c)=>{try{let{error:d}=await i.supabase.from("calibrations").upsert({profile_id:c,letter:a,pattern_data:{snapshots:[{data:b,profileId:c,isNegative:!1,score:0}]},updated_at:new Date().toISOString()},{onConflict:"profile_id,letter"});if(d)throw d;return console.log(`âœ… Saved calibration for letter ${a}`),!0}catch(a){return console.error("âŒ Error saving calibration:",a),n(`Failed to save: ${a instanceof Error?a.message:"Unknown error"}`),!1}},L=()=>{B(),e()},M=(0,c.useCallback)(a=>{"Escape"===a.key&&L()},[]);return(0,c.useEffect)(()=>(window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)),[M]),(0,b.jsxs)("div",{className:"jsx-efac7a41430af102 fixed inset-0 bg-black/90 flex items-center justify-center z-[10000]",children:[(0,b.jsxs)("div",{className:"jsx-efac7a41430af102 bg-[rgba(30,30,30,0.98)] rounded-[30px] p-10 w-[90%] max-w-[700px] max-h-[90vh] overflow-y-auto border-3 border-[#7CB342] shadow-[0_20px_60px_rgba(0,0,0,0.8)] relative",children:[(0,b.jsx)("button",{onClick:L,className:"jsx-efac7a41430af102 absolute top-5 right-5 bg-white/10 border-none text-white text-2xl w-10 h-10 rounded-full cursor-pointer transition-all hover:bg-[rgba(255,67,54,0.3)] hover:rotate-90",children:"âœ•"}),(0,b.jsx)("div",{className:"jsx-efac7a41430af102 text-center text-[#ddd] text-base mb-5",children:"Click the letter to hear its sound. Click each box below to record 5 sounds."}),(0,b.jsxs)("div",{className:"jsx-efac7a41430af102 flex items-center justify-center gap-5 my-5",children:[(0,b.jsx)("div",{onClick:F,style:{textShadow:"0 10px 30px rgba(253, 216, 53, 0.5)"},className:"jsx-efac7a41430af102 text-[180px] font-bold text-[#FDD835] cursor-pointer inline-block transition-all hover:scale-110",children:a}),(0,b.jsx)("div",{onClick:F,style:{filter:"drop-shadow(0 2px 8px rgba(253, 216, 53, 0.4))"},className:"jsx-efac7a41430af102 w-[60px] h-[60px] cursor-pointer opacity-70 transition-all hover:opacity-100 hover:scale-115",children:(0,b.jsx)("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"jsx-efac7a41430af102 w-full h-full fill-[#FDD835]",children:(0,b.jsx)("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z",className:"jsx-efac7a41430af102"})})})]}),(0,b.jsxs)("div",{className:"jsx-efac7a41430af102 flex gap-2.5 justify-center mt-8 relative",children:[o&&(0,b.jsx)("div",{className:"jsx-efac7a41430af102 absolute bottom-[90px] left-[50px] animate-[arrowHover_2s_ease-in-out_infinite,arrowPulse_1.5s_ease-in-out_infinite]",children:(0,b.jsx)("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",style:{filter:"drop-shadow(0 2px 10px rgba(124, 179, 66, 0.8))"},className:"jsx-efac7a41430af102 w-[50px] h-[50px]",children:(0,b.jsx)("path",{d:"M12 4L12 20M12 20L5 13M12 20L19 13",stroke:"#7CB342",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none",className:"jsx-efac7a41430af102"})})}),Array.from({length:d.SNAPSHOTS_NEEDED}).map((c,d)=>(0,b.jsxs)("div",{onClick:()=>(b=>{if(b!==v.current.length||w.current)return;p(!1),x.current=b;let c=[...s];c[b]="recording",t(c),n(`Recording ${b+1}/5... Get ready...`),setTimeout(()=>{w.current=!0,n(`Recording ${b+1}/5... Say "${a}" NOW!`)},400)})(d),className:`jsx-efac7a41430af102 
                w-[100px] h-[80px] bg-black/50 border-2 rounded-[10px] transition-all relative
                ${"ready"===s[d]?"border-[#FDD835] shadow-[0_0_15px_rgba(253,216,53,0.5)] animate-pulse cursor-pointer":""}
                ${"recording"===s[d]?"border-[#F44336] bg-[rgba(244,67,54,0.2)] animate-pulse cursor-wait":""}
                ${"captured"===s[d]?"border-[#7CB342] bg-[rgba(124,179,66,0.1)] cursor-default":""}
                ${"empty"===s[d]?"border-[rgba(124,179,66,0.3)] cursor-not-allowed":""}
              `,children:["ready"===s[d]&&(0,b.jsx)("div",{className:"jsx-efac7a41430af102 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 opacity-70",children:(0,b.jsxs)("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",style:{filter:"drop-shadow(0 0 5px rgba(253, 216, 53, 0.5))"},className:"jsx-efac7a41430af102 w-full h-full fill-[#FDD835]",children:[(0,b.jsx)("path",{d:"M12 2C10.9 2 10 2.9 10 4V12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12V4C14 2.9 13.1 2 12 2Z",className:"jsx-efac7a41430af102"}),(0,b.jsx)("path",{d:"M17 11C17 13.76 14.76 16 12 16C9.24 16 7 13.76 7 11H5C5 14.53 7.61 17.43 11 17.92V21H13V17.92C16.39 17.43 19 14.53 19 11H17Z",className:"jsx-efac7a41430af102"})]})}),(0,b.jsx)("canvas",{ref:a=>{z.current[d]=a},width:100,height:80,className:"jsx-efac7a41430af102 w-full h-full"})]},d))]}),(0,b.jsx)("div",{className:"jsx-efac7a41430af102 text-center text-[#ddd] text-lg mt-5",children:m}),q&&(0,b.jsx)("div",{onClick:()=>{k(a),L()},className:"jsx-efac7a41430af102 w-20 h-20 bg-[#7CB342] rounded-full cursor-pointer transition-all mx-auto mt-8 flex items-center justify-center shadow-[0_4px_15px_rgba(124,179,66,0.5)] animate-[nextButtonPulse_1.5s_ease-in-out_infinite] hover:scale-110 hover:bg-[#8BC34A] hover:shadow-[0_6px_20px_rgba(124,179,66,0.7)]",children:(0,b.jsx)("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"jsx-efac7a41430af102 w-10 h-10 fill-white",children:(0,b.jsx)("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",className:"jsx-efac7a41430af102"})})})]}),(0,b.jsx)(f.default,{id:"efac7a41430af102",children:"@keyframes arrowHover{0%,to{transform:translateY(0)}50%{transform:translateY(-10px)}}@keyframes arrowPulse{0%,to{opacity:.8}50%{opacity:1}}@keyframes nextButtonPulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}"})]})}let l={vowels:"VOWELS",easy:"EASY CONSONANTS",common:"COMMON CONSONANTS",advanced:"ADVANCED"};function m(){let{currentProfileId:a,isLoading:f}=(0,j.useProfileContext)(),[g,h]=(0,c.useState)(new Set),[m,n]=(0,c.useState)(null);(0,c.useEffect)(()=>{a&&o()},[a]);let o=async()=>{if(a)try{let{data:b,error:c}=await i.supabase.from("calibrations").select("letter").eq("profile_id",a);if(c)throw c;if(b){let a=new Set(b.map(a=>a.letter));h(a)}}catch(a){console.error("Error loading calibrations:",a)}};if(f)return(0,b.jsx)("div",{className:"text-center text-gray-400",children:"Loading profile..."});if(!a)return(0,b.jsx)("div",{className:"text-center text-gray-400",children:"No profile selected"});let p=d.PHONEMES.reduce((a,b)=>(a[b.group]||(a[b.group]=[]),a[b.group].push(b),a),{});return(0,b.jsxs)("div",{children:[Object.entries(p).map(([a,c])=>(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("div",{className:"pt-4 pb-2 text-base font-bold text-yellow-400 border-b-2 border-yellow-400/30 mb-4",children:l[a]}),(0,b.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(150px,1fr))] gap-4",children:c.map(a=>(0,b.jsx)(e,{phoneme:a,isCalibrated:g.has(a.letter),isRecording:!1,onClick:()=>{var b;console.log("Letter clicked:",b=a.letter),n(b)}},a.letter))})]},a)),m&&(0,b.jsx)(k,{letter:m,onClose:()=>{n(null)},onSuccess:a=>{console.log("ðŸŸ¢ CalibrationGrid received success for letter:",a);let b=new Set([...g,a]);h(b),console.log("ðŸŸ¢ Updated calibrated letters:",Array.from(b));let c=d.PHONEMES.findIndex(b=>b.letter===a);console.log("ðŸŸ¢ Current letter index:",c);for(let a=c+1;a<d.PHONEMES.length;a++)if(!b.has(d.PHONEMES[a].letter)){console.log("ðŸŸ¢ Auto-advancing to next letter:",d.PHONEMES[a].letter),n(d.PHONEMES[a].letter);return}console.log("ðŸŸ¢ No more uncalibrated letters, closing modal"),n(null)}},m)]})}a.s(["default",()=>m],22640)}];

//# sourceMappingURL=app_components_CalibrationGrid_tsx_575e4d92._.js.map